<!DOCTYPE html>
<html lang="ko">
  <!-- 브라우저가 서버와 대화하는 방법 -->
  <head>
    <!-- 문서의 메타데이터(정보)를 담는 영역 
    브라우저에는 직접 표시되지 않는다 
    -->
    <meta charset="UTF-8" />
    <!-- 문자 인코딩을 utf-8로 해야 한글이 깨지지 않는다 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 모바일 기기 환경 -->
    <title>1017</title>
    <!-- 브라우저 탭의 제목 -->
  </head>
  <body>
    <!-- 실제 사용자에게 보이는 영역 -->
    <button onclick="post_register()">등록(post요청)</button>
    <button onclick="put_modify()">수정(put요청)</button>
    <button onclick="delete_remove()">삭제(delete요청)</button>
    <!-- 버튼 태그로 클릭시 onclick 각 ()함수를 실행 -->

    <script>
      // 서버와 통신하는 핵심 로직인 fetch API를 사용
      // 서버와 비동기 통신을 담당하는 자바스크립트의 약속
      function delete_remove() {
        // delete_remove()라는 이름의 함수를 생성
        // ❓ 왜 fetch를 사용하나요?
        // fetch는 브라우저가 서버에 데이터를 요청하거나 보낼 때 사용하는 최신 웹 표준 API입니다.
        fetch("http://localhost:3000/post/3", {
          // 요청할 URL
          method: "DELETE",
          // 요청방식 method
        })
          .then((response) => response.json())
          // 체인 시작 (첫 번째 약속):
          // 응답을 JSON 객체로 변환
          .then((json) => {
            //체인 (두 번째 약속):
            console.log(json);
            alert("삭제");
          })
          .catch((error) => console.error("Error:", error));
        // catch는 있어야함 오류처리
        // /❓ 왜 .catch는 꼭 써야 하나요? .catch는 오류 처리기입니다.
        //  이것이 없으면 오류 발생 시 브라우저 콘솔에만 에러가 뜨고,
        //  애플리케이션이 멈추거나 예상치 못한 동작을 할 수 있습니다.
        // 안정적인 통신을 위해 반드시 포함하는 것이 좋습니다.
      }
      //
      function put_modify() {
        fetch("http://localhost:3000/post/1", {
          // 요청 URL 1번 게시글
          method: "PUT",
          // 요청 방식 PUT
          headers: {
            // 요청 헤더 본문에 대한 추가 정보를 서버에 전달

            "Content-Type": "application/json",
            // 서버에게 요청 본문(body)의 데이터 형식이 JSON이라고 알려줍니다.
          },
          body: JSON.stringify({
            // 서버로 보낼 실제 데이터
            // 자바스크립트 객체를 네트워크 통신이 가능한 문자열(JSON 형식)로 변환하는 함수입니다.
            // 이 과정이 없으면 서버는 데이터를 읽을 수 없습니다.
            title: "몇 번글 삭제",
            content: "Delete What content",
            id: 1,
            // 1번 글에 적용하고 싶은 새로운 데이터
          }),
        })
          .then((response) => response.json())
          // {'code': 'not found'} => json 으로 바꿀수 있는데
          // not found 면 못 바꾼다
          .then((json) => {
            console.log(json);
            alert("수정");
          })
          .catch((error) => console.error("Error:", error));
      }
      //
      function post_register() {
        // ★요청 리소스 http://localhost:3000/post ★
        // ★http: 라는 프로토콜 과 서버 정보가 다 있는게 URL★
        // ★요청하는 방식에 따라 처리가 달라짐★
        // ★이를 조합한게 Restful API Rest방식★
        fetch("http://localhost:3000/post", {
          //★fetch 서버에 요청 방식을 지정★
          method: "POST",
          headers: {
            "Content-Type": "applicaiton/json",
          },
          body: JSON.stringify({
            title: "1post test",
            content: "post content",
            id: 1,
          }),
        })
          .then((response) => response.json())
          .then((json) => {
            console.log(json);
            alert("등록이됨");
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </body>
</html>
